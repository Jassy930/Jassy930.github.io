<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/witch_128px.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/witch_128px.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/witch_128px.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://blog.jassy.wang').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="C用了很久了，但是也没有说很系统平铺的整体看过，一直是用什么会什么，不用什么就过去了。既然C已经被我当做是一门已经掌握的语言，所以就重新扫一遍C里面不那么面熟的东西或者理解有偏差的东西，当做是个记录以备复习使用，也可以对C打个结了。 auto &amp;amp;&amp;amp; register &amp;amp;&amp;amp; static怎么也没想到会把这三个放在一起，一个是C++中常用的声明类型的关键字，一个没见过的">
<meta name="keywords" content="C">
<meta property="og:type" content="article">
<meta property="og:title" content="C补遗：C语言里不那么面熟的关键字">
<meta property="og:url" content="http://blog.jassy.wang/archives/f3b58568.html">
<meta property="og:site_name" content="弱者">
<meta property="og:description" content="C用了很久了，但是也没有说很系统平铺的整体看过，一直是用什么会什么，不用什么就过去了。既然C已经被我当做是一门已经掌握的语言，所以就重新扫一遍C里面不那么面熟的东西或者理解有偏差的东西，当做是个记录以备复习使用，也可以对C打个结了。 auto &amp;amp;&amp;amp; register &amp;amp;&amp;amp; static怎么也没想到会把这三个放在一起，一个是C++中常用的声明类型的关键字，一个没见过的">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-12-19T03:41:02.892Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C补遗：C语言里不那么面熟的关键字">
<meta name="twitter:description" content="C用了很久了，但是也没有说很系统平铺的整体看过，一直是用什么会什么，不用什么就过去了。既然C已经被我当做是一门已经掌握的语言，所以就重新扫一遍C里面不那么面熟的东西或者理解有偏差的东西，当做是个记录以备复习使用，也可以对C打个结了。 auto &amp;amp;&amp;amp; register &amp;amp;&amp;amp; static怎么也没想到会把这三个放在一起，一个是C++中常用的声明类型的关键字，一个没见过的">

<link rel="canonical" href="http://blog.jassy.wang/archives/f3b58568.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>C补遗：C语言里不那么面熟的关键字 | 弱者</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154771641-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-154771641-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2cde5fc3e525b8ac3c86c6bd41fdb0f1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">弱者</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">15</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">20</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="default">
    <link itemprop="mainEntityOfPage" href="http://blog.jassy.wang/archives/f3b58568.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jassy">
      <meta itemprop="description" content="Little blog, Little think">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弱者">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C补遗：C语言里不那么面熟的关键字
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-06 13:23:32" itemprop="dateCreated datePublished" datetime="2019-12-06T13:23:32+08:00">2019-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-12-19 11:41:02" itemprop="dateModified" datetime="2019-12-19T11:41:02+08:00">2019-12-19</time>
              </span>

          
            <span id="/archives/f3b58568.html" class="post-meta-item leancloud_visitors" data-flag-title="C补遗：C语言里不那么面熟的关键字" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/archives/f3b58568.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/f3b58568.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>C用了很久了，但是也没有说很系统平铺的整体看过，一直是用什么会什么，不用什么就过去了。既然C已经被我当做是一门已经掌握的语言，所以就重新扫一遍C里面不那么面熟的东西或者理解有偏差的东西，当做是个记录以备复习使用，也可以对C打个结了。</p>
<h2 id="auto-amp-amp-register-amp-amp-static"><a href="#auto-amp-amp-register-amp-amp-static" class="headerlink" title="auto &amp;&amp; register &amp;&amp; static"></a>auto &amp;&amp; register &amp;&amp; static</h2><p>怎么也没想到会把这三个放在一起，一个是C++中常用的声明类型的关键字，一个没见过的，和一个还算常用的，这里主要理解的偏差还是在 <code>auto</code> 上。</p>
<p>在C++中，auto作为一种自动判断变量类型的定义存在，比如当我使用 <code>auto c = 10;</code> 去定义 <code>c</code> 这个变量的时候，是和 <code>int c = 10;</code> 的作用是一样的，这样可以节省很多去考虑这个变量具体是什么类型以及大量的敲字母的时间，还可以避免一些打字错误，比如  <code>vector&lt;map&lt;int,string&gt;&gt;::iterator a =</code> 这种东西可以直接 <code>auto a =</code> 还是挺爽的。顺便这里提一嘴，C++中的 <code>auto</code> 后面必须赋值，否则编译器不知道到底要初始化成什么类型的。</p>
<a id="more"></a>
<p>在C中，<code>auto</code> 关键字是用来指定变量的存储位置的。这也是为什么要和 <code>static</code> 和 <code>register</code> 一起讲。 <code>static</code> 说过很多遍也用过很多遍了，是存储在静态存储区的，而这个不太常见的 <code>register</code> 就是指的平时我们使用中的变量，是直接存储在堆或者栈中的，所以 <code>auto</code> 关键字就只是用来指定是用 <code>static</code> 修饰的还是用 <code>register</code> 修饰的，也就是新建变量的存储位置，举例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>; <span class="comment">//平时这样定义就相当于 auto in a = 10; auto相当于省略</span></span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> b = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> c = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>注意的是，平时我们在 <code>int a = 10;</code> 这样定义的时候就相当于省略了 <code>auto</code> 关键字，上面这段在定义的时候就是 a 和 b 定义是在堆或者栈中的，c定义在静态存储区中。而且在使用了 <code>auto</code> <code>register</code> <code>static</code> 修饰后，仍然需要增加变量类型，因为他们并不是定义变量类型的，而是变量的存储区域。</p>
<p>C中的 <code>auto</code> 并不是复杂，而是主要要注意一下与C++中的 <code>auto</code> 的区别。</p>
<h2 id="C99-新增关键字"><a href="#C99-新增关键字" class="headerlink" title="C99 新增关键字"></a>C99 新增关键字</h2><p>后面这两个部分我定义为《很少见看上去很新但有可能我以后再也不会用到的关键字》，是新定义的关键字。随着时代发展社会进步，所以 C 的标准也在一直跟着更新，这两个部分就是在新的标准下引入的新的关键字。</p>
<h3 id="Bool"><a href="#Bool" class="headerlink" title="_Bool"></a>_Bool</h3><p>这个挺明显的，就是补齐C中没有 <code>bool</code> 类型的缺憾了，不同程序员自己对 <code>bool</code> 类型的定义都不一样，所以可能会产生分歧，这个可以统一一下。定义的true为1，false为0，类型的具体大小由编译器去决定，标准只要求了大小要能够存放0和1这两个值，gcc是使用char实现的。需要引入 <code>&lt;stdbool.h&gt;</code></p>
<p>另外，对bool类型赋0和1以外的值，gcc会强制赋值成1，所以 <code>bool</code> 类型的值只存在0和1两种可能</p>
<p>另另外，C++中是 <code>bool</code> 类型，C中是 <code>_Bool</code> 类型。</p>
<h3 id="Complex-amp-amp-Imaginary"><a href="#Complex-amp-amp-Imaginary" class="headerlink" title="_Complex &amp;&amp; _Imaginary"></a>_Complex &amp;&amp; _Imaginary</h3><p>复数！复数！复数你敢想？就在C里面，复数！</p>
<p>需要引入 <code>&lt;complex.h&gt;</code> , <code>_Imaginary</code> 作为虚数，但是并没有强制要求编译器去实现虚数部，所以很多都是只实现了 <code>complex</code>。</p>
<p><code>complex</code> 分三种类型:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> <span class="keyword">_Complex</span> fc = <span class="number">1.0f</span> + <span class="number">1.0</span><span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">double</span> <span class="keyword">_Complex</span> fc = <span class="number">1.0</span> + <span class="number">1.0</span>i;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">double</span> <span class="keyword">_Complex</span> fc = <span class="number">1.0</span> + <span class="number">1.0</span>i;</span><br></pre></td></tr></table></figure>

<h3 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h3><p>内联函数，与C++中的 <code>inline</code> 作用相同用来提高程序运行效率，减少函数调用开支。但是只是建议编译器这样去做，编译器可以选择性忽略（可配置）。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内联函数中不能定义可改变的 <code>static</code> 变量，不能引用具有内部链接的变量。</p>
<p>建议内联函数只用在函数体比较简单的情况下，否则代码展开太过庞大。</p>
<h3 id="restrict"><a href="#restrict" class="headerlink" title="restrict"></a>restrict</h3><p>这是一个只对于指针的修饰符，被 <code>restrict</code> 修饰的指针所指向的内容的所有操作都是基于这个指针进行的，不会从其他地方进行修改，这样可以帮助编译器进行更好的代码优化提高代码效率。如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 某 restrict 指针 a</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> *<span class="keyword">restrict</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    *a++;</span><br><span class="line">    *a++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种情况下，编译器知道在f处理过程中不可能从别的地方对 <code>*a</code> 进行修改，所以可以直接将两句优化为 <code>*a+=2;</code></p>
<p>并且两个不同的 <code>restrict</code> 指针必定是两个分别指向不同区域的指针，不会是相同的指针，可以因此对一些函数输入参数进行限定。如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> * <span class="title">memcpy</span><span class="params">(<span class="keyword">void</span> * <span class="keyword">restrict</span> s1, <span class="keyword">const</span> <span class="keyword">void</span> * <span class="keyword">restrict</span> s2, <span class="keyword">size_t</span> n)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> * <span class="title">memove</span><span class="params">(<span class="keyword">void</span> * s1, <span class="keyword">const</span> <span class="keyword">void</span> * s2, <span class="keyword">size_t</span> n)</span></span>;</span><br></pre></td></tr></table></figure>

<p>对于 <code>memcpy</code> 来讲，两个指针区域的重叠是存在危险的行为，所以需要使用 <code>restrict</code> 进行修饰。</p>
<p>另外，这个关键字C++中并没有引入。</p>
<p>另另外，在linux中 <code>restrict</code> 需要替换为 <code>_restrict</code></p>
<h2 id="C11-新增关键字"><a href="#C11-新增关键字" class="headerlink" title="C11 新增关键字"></a>C11 新增关键字</h2><h3 id="Alignas-amp-amp-Alignof"><a href="#Alignas-amp-amp-Alignof" class="headerlink" title="_Alignas &amp;&amp; _Alignof"></a>_Alignas &amp;&amp; _Alignof</h3><p>加个 cppreference 的链接辅助：</p>
<p><a href="https://zh.cppreference.com/w/c/language/_Alignas" target="_blank" rel="noopener">_Alignas</a></p>
<p><a href="https://zh.cppreference.com/w/c/language/_Alignof" target="_blank" rel="noopener">_Alignof</a></p>
<p>修改被声明对象的对齐说明，是的，这个对齐说明就是 <code>struct</code> 的那个对齐说明，后面可以放置数字或者一个类型，如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdalign.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="comment">//  每一个 struct sse_t 类型的对象会在 16 字节边界对齐</span></span><br><span class="line"><span class="comment">// （注意：需要支持 DR 444 ）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sse_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  alignas(<span class="number">16</span>) <span class="keyword">float</span> sse_data[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这种 struct data 的每一个对象都会在 128 字节边界对齐</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">data</span> &#123;</span></span><br><span class="line">  <span class="keyword">char</span> x;</span><br><span class="line">  alignas(<span class="number">128</span>) <span class="keyword">char</span> cacheline[<span class="number">128</span>]; <span class="comment">// 过对齐的 char 数组对象，</span></span><br><span class="line">                                    <span class="comment">// 不是过对齐的 char 对象的数组</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(data) = %zu (1 byte + 127 bytes padding + 128-byte array)\n"</span>,</span><br><span class="line">           <span class="keyword">sizeof</span>(struct data));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alignment of sse_t is %zu\n"</span>, <span class="keyword">alignof</span>(struct <span class="keyword">sse_t</span>));</span><br><span class="line">    alignas(<span class="number">2048</span>) <span class="class"><span class="keyword">struct</span> <span class="title">data</span> <span class="title">d</span>;</span> <span class="comment">// 此 struct data 的实例会更严格地对齐</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sizeof(data) = 256 (1 byte + 127 bytes padding + 128-byte array)</span><br><span class="line">alignment of sse_t is 16</span><br></pre></td></tr></table></figure>

<p>需要注意的是如果 <code>alignas</code> 后面的表达式为0会被忽略，如果定义了多个会使用最严格的，这个最严格的描述包括无任何 <code>alignas</code> 描述的原始对齐方式。</p>
<p><code>_Alignof</code> 就是获取这个类型的对齐要求。如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdalign.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Alignment of char = %zu\n"</span>, <span class="keyword">alignof</span>(<span class="keyword">char</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Alignment of max_align_t = %zu\n"</span>, <span class="keyword">alignof</span>(<span class="keyword">max_align_t</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alignof(float[10]) = %zu\n"</span>, <span class="keyword">alignof</span>(<span class="keyword">float</span>[<span class="number">10</span>]));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"alignof(struct&#123;char c; int n;&#125;) = %zu\n"</span>,</span><br><span class="line">            <span class="keyword">alignof</span>(struct &#123;<span class="keyword">char</span> c; <span class="keyword">int</span> n;&#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Alignment of char = 1</span><br><span class="line">Alignment of max_align_t = 16</span><br><span class="line">alignof(float[10]) = 4</span><br><span class="line">alignof(struct&#123;char c; int n;&#125;) = 4</span><br></pre></td></tr></table></figure>

<h3 id="Atomic"><a href="#Atomic" class="headerlink" title="_Atomic"></a>_Atomic</h3><p>是用于多线程的玩意，用这个修饰符限定的变量的操作只能是<strong>原子性</strong>的，类似于互锁，同一时间只能有一个线程访问这个参数，类似于线程锁。定义方式：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_Atomic <span class="keyword">int</span> c = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Generic"><a href="#Generic" class="headerlink" title="_Generic"></a>_Generic</h3><p>泛型。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GENERAL_ABS(x) _Generic((x),int:abs,float:fabsf,double:fabs)(x)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"intabs:%d\n"</span>,GENERAL_ABS(<span class="number">-12</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"floatabs:%f\n"</span>,GENERAL_ABS(<span class="number">-12.04f</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"doubleabs:%f\n"</span>,GENERAL_ABS(<span class="number">-13.09876</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> b=<span class="number">0</span>,c=<span class="number">0</span>;</span><br><span class="line">    _Generic(a+<span class="number">0.1f</span>,<span class="keyword">int</span>:b,<span class="keyword">float</span>:c,<span class="keyword">default</span>:b)++;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"b=%d,c=%d\n"</span>,b,c);</span><br><span class="line">    _Generic(a+=<span class="number">1.1f</span>,<span class="keyword">int</span>:b,<span class="keyword">float</span>:c,<span class="keyword">default</span>:b)++;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a=%d,b=%d,c=%d\n"</span>,a,b,c);</span><br></pre></td></tr></table></figure>

<p>对不同的输入参数的类型执行不同的函数，x为函数的输入参数，后面是对应不同输入参数类型的操作，最后可以加一个 <code>defalut</code> 用于其他的输出结果。</p>
<h3 id="Noreturn"><a href="#Noreturn" class="headerlink" title="_Noreturn"></a>_Noreturn</h3><p><a href="https://en.cppreference.com/w/c/language/_Noreturn" target="_blank" rel="noopener">cppreference</a></p>
<p>这是一个描述函数的关键词，用于表示该函数执行完毕后不会返回，请注意这里是<strong>不会返回</strong>，而不是像 <code>void</code> 一样是返回空，而是根本不会返回，编译器也会因此对代码进行优化。例如:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">noreturn <span class="keyword">void</span> <span class="title">stop_now</span><span class="params">(<span class="keyword">int</span> i)</span> <span class="comment">// or _Noreturn void stop_now(int i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) <span class="built_in">exit</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这个说明符并没有什么<strong>实际</strong>的作用，这个实际体现在，他是程序员对编译器的一种承诺，我不会让这个函数返回的，你也别让他返回，只是一个提示、通知的作用，但是你要在函数里非要返回，编译器也不会在你返回的时候强行停止掉。that’s it.</p>
<h3 id="Static-assert"><a href="#Static-assert" class="headerlink" title="_Static_assert"></a>_Static_assert</h3><p><a href="https://en.cppreference.com/w/c/error/static_assert" target="_blank" rel="noopener">cppreference</a></p>
<p>静态断言，如果第一个参数的值为false（可以输入一个表达式或者string），那么编译器会报出第二个string的错误，同时编译失败，如果第一个表达式的值为true的话没有任何影响。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static_assert</span>(<span class="number">2</span> + <span class="number">2</span> == <span class="number">4</span>, <span class="string">"2+2 isn't 4"</span>);      <span class="comment">// well-formed</span></span><br><span class="line">    <span class="keyword">static_assert</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>) &lt; <span class="keyword">sizeof</span>(<span class="keyword">char</span>),</span><br><span class="line">                 <span class="string">"this program requires that int is less than char"</span>); <span class="comment">// compile-time error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Thread-local"><a href="#Thread-local" class="headerlink" title="_Thread_local"></a>_Thread_local</h3><blockquote>
<p>便捷宏，可用于指定对象具有线程本地存储持续时间。</p>
</blockquote>
<p>大家都是这么说的，但是没找到 C 的很确切的定义和说明。但是它是一个描述变量的，是用来描述变量的生命周期为线程存储期，可以和 <code>static</code> 和 <code>extern</code> 结合来指定内部或者外部链接，具体的声明周期描述如下：</p>
<blockquote>
<p><strong><em>线程（thread）</em></strong>存储期。对象的存储在线程开始时分配，而在线程结束时解分配。每个线程拥有其自身的对象实例。唯有声明为 <code>thread_local</code> 的对象拥有此存储期。 <code>thread_local</code> 能与 <code>static</code> 或 <code>extern</code> 一同出现，以调整连接。关于具有此存储期的对象的初始化的细节。</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实这样顺下来，不清楚不了解的东西还很多。主要原因还是因为在做项目的过程中很多东西没有很高的要求和需求，那么也不需要用到，这样的话没有动力不会去了解去理解，一直只是在嵌入式中使用的C，所以很多东西比如线程复数等等根本没有想到会出现，也更加没有用过了，这边只是一个对C语言知识的补遗，我不能通过一个补遗就了解这些知识，但是可以通过这个补遗知道有这样一回事，提前有准备，不会突然被一棒子打到。嗯。</p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/weixin.png" alt="Jassy WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Jassy Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/9e937ad5.html" rel="prev" title="想出去玩？去日本吧！——准备工作篇">
      <i class="fa fa-chevron-left"></i> 想出去玩？去日本吧！——准备工作篇
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/dd79e3bb.html" rel="next" title="LeetCode Contest No.167">
      LeetCode Contest No.167 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-valine">valine</a></li>
            <li class="tab"><a href="#comment-gitalk">gitalk</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="comments"></div>
            </div>
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments" id="gitalk-container"></div>
            </div>
        </div>
      </div>
      <script>
        window.addEventListener('tabs:register', () => {
          let activeClass = '';
            activeClass = localStorage.getItem('comments_active') || activeClass;
          if (activeClass) {
            let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
            if (activeTab) {
              activeTab.click();
            }
          }
        });
        window.addEventListener('tabs:click', event => {
          let commentClass = event.target.classList[1];
          localStorage.setItem('comments_active', commentClass);
        });
      </script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#auto-amp-amp-register-amp-amp-static"><span class="nav-number">1.</span> <span class="nav-text">auto &amp;&amp; register &amp;&amp; static</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C99-新增关键字"><span class="nav-number">2.</span> <span class="nav-text">C99 新增关键字</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Bool"><span class="nav-number">2.1.</span> <span class="nav-text">_Bool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Complex-amp-amp-Imaginary"><span class="nav-number">2.2.</span> <span class="nav-text">_Complex &amp;&amp; _Imaginary</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inline"><span class="nav-number">2.3.</span> <span class="nav-text">inline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#restrict"><span class="nav-number">2.4.</span> <span class="nav-text">restrict</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C11-新增关键字"><span class="nav-number">3.</span> <span class="nav-text">C11 新增关键字</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Alignas-amp-amp-Alignof"><span class="nav-number">3.1.</span> <span class="nav-text">_Alignas &amp;&amp; _Alignof</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Atomic"><span class="nav-number">3.2.</span> <span class="nav-text">_Atomic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generic"><span class="nav-number">3.3.</span> <span class="nav-text">_Generic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Noreturn"><span class="nav-number">3.4.</span> <span class="nav-text">_Noreturn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Static-assert"><span class="nav-number">3.5.</span> <span class="nav-text">_Static_assert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thread-local"><span class="nav-number">3.6.</span> <span class="nav-text">_Thread_local</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jassy"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Jassy</p>
  <div class="site-description" itemprop="description">Little blog, Little think</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Jassy930" title="GitHub → https://github.com/Jassy930" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:fengw930@163.com" title="E-Mail → mailto:fengw930@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.jassy.wang" title="Weibo → https://weibo.jassy.wang" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Link
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blog.hetty.today/" title="https://blog.hetty.today/" rel="noopener" target="_blank">Hetty</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://chenpy.com/" title="https://chenpy.com/" rel="noopener" target="_blank">Cpy</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn" rel="noopener" target="_blank">京ICP备16009867号-1 </a>
      <img src="/images/beian.png" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-shower"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jassy</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.5.0
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count"> |  Total 41.5k</span>
</div>

        








        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'gvQsnIBkcSU2IDQ4t3qP0B2U-gzGzoHsz',
    appKey: 'WrMn9MyGJfJasftbSH6doEVs',
    placeholder: "Just go go",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: true,
    serverURLs: ''
  });
}, window.Valine);
</script>

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '5dc1438e00012d02d483',
      clientSecret: 'fbd3a9af9bebb027aeeb2d6df3ab4f901c59bb9b',
      repo: 'Jassy930.github.io',
      owner: 'Jassy930',
      admin: ['Jassy930'],
      id: '394e8c08aadf32f4f56669daf8a04485',
        language: 'zh-CN',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

</body>
</html>
